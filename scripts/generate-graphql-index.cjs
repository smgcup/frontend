const fs = require('fs'); // eslint-disable-line @typescript-eslint/no-require-imports
const path = require('path'); // eslint-disable-line @typescript-eslint/no-require-imports

const graphqlDir = path.join(__dirname, '../src/graphql');
const outputFile = path.join(graphqlDir, 'index.ts');

function findGeneratedFiles(dir, fileList = []) {
    const files = fs.readdirSync(dir);

    files.forEach((file) => {
        const filePath = path.join(dir, file);
        const stat = fs.statSync(filePath);

        if (stat.isDirectory()) {
            findGeneratedFiles(filePath, fileList);
        } else if (file.endsWith('.generated.ts')) {
            const relativePath = path.relative(graphqlDir, filePath);
            fileList.push(relativePath);
        }
    });

    return fileList;
}

function generateIndexFile() {
    const generatedFiles = findGeneratedFiles(graphqlDir);

    if (generatedFiles.length === 0) {
        console.warn('⚠️  No generated files found');
        return;
    }

    const exports = generatedFiles
        .map((file) => {
            const importPath = `./${file.replace(/\.ts$/, '')}`;
            return `export * from '${importPath}';`;
        })
        .sort()
        .join('\n');

    const content = `// This file is auto-generated by scripts/generate-graphql-index.cjs
// Do not edit this file manually

// Export all types from generated types file
export * from '../generated/types';

// Export all generated operations, fragments, and documents
${exports}
`;

    fs.writeFileSync(outputFile, content, 'utf8');
    console.log(`✅ Generated index.ts with ${generatedFiles.length} exports`);
}

generateIndexFile();
